# Go Task Management API

A clean, well-structured REST API built with Go for managing tasks with user authentication. This project demonstrates Go best practices, clean architecture, and is perfect for beginners learning Go web development.

## 🚀 Features

- **User Management**: Create users with automatic API key generation
- **Task CRUD Operations**: Create, read, update, delete tasks
- **Task Completion**: Mark tasks as complete/incomplete
- **Search & Filter**: Search tasks by title and description
- **Authentication**: API key-based authentication
- **Soft Delete**: Tasks are soft-deleted (can be restored)
- **Clean Architecture**: Proper separation of concerns
- **Middleware**: Authentication, logging, and panic recovery
- **Graceful Shutdown**: Proper server lifecycle management
- **Connection Pooling**: Optimized database connections

## 📋 Requirements

- Go 1.19+
- PostgreSQL database
- Git

## 🛠️ Installation & Setup

### 1. Clone the Repository
```bash
git clone <your-repo-url>
cd go-hello-world
```

### 2. Install Dependencies
```bash
go mod download
```

### 3. Set Up Environment Variables
```bash
cp .env.example .env
# Edit .env with your database configuration
```

Required environment variables:
- `PORT`: Server port (default: 8080)
- `DB_URL`: PostgreSQL connection string

### 4. Database Setup
Make sure PostgreSQL is running and create a database. The connection string format:
```
postgres://username:password@localhost:5432/database_name?sslmode=disable
```

### 5. Run the Application
```bash
go run main.go
```

The server will start on the configured port (default: 8080).

## 📚 API Documentation

### Base URL
```
http://localhost:8080/v1
```

### Authentication
Most endpoints require authentication via API key in the Authorization header:
```
Authorization: APIKEY your_api_key_here
```

### Endpoints

#### Health Check
```http
GET /v1/healthz
```
**Response:** Returns server status

#### Create User
```http
POST /v1/user
Content-Type: application/json

{
  "username": "john_doe"
}
```
**Response:** Returns user details with API key

#### Get Current User
```http
GET /v1/user
Authorization: APIKEY your_api_key
```
**Response:** Returns authenticated user details

#### Create Task
```http
POST /v1/tasks
Authorization: APIKEY your_api_key
Content-Type: application/json

{
  "title": "Learn Go programming",
  "description": "Complete Go tutorial and build a project"
}
```

#### Get All Tasks
```http
GET /v1/tasks
Authorization: APIKEY your_api_key
```

#### Get Specific Task
```http
GET /v1/tasks/{taskId}
Authorization: APIKEY your_api_key
```

#### Update Task
```http
PUT /v1/tasks/{taskId}
Authorization: APIKEY your_api_key
Content-Type: application/json

{
  "title": "Updated title",
  "description": "Updated description",
  "is_completed": true
}
```

#### Toggle Task Completion
```http
PATCH /v1/tasks/{taskId}/complete
Authorization: APIKEY your_api_key
Content-Type: application/json

{
  "is_completed": true
}
```

#### Delete Task
```http
DELETE /v1/tasks/{taskId}
Authorization: APIKEY your_api_key
```

#### Search Tasks
```http
GET /v1/tasks/search?query=go&limit=10
Authorization: APIKEY your_api_key
```

## 🏗️ Project Structure

```
├── main.go                     # Application entry point
├── .env.example               # Environment configuration template
├── handlers/                  # HTTP handlers (controllers)
│   ├── api_config.go         # Database configuration
│   ├── json.go               # JSON response utilities
│   ├── users.go              # User handlers
│   ├── tasks.go              # Task handlers
│   └── utils.go              # Utility functions
├── internal/
│   ├── auth/                 # Authentication logic
│   │   └── auth.go
│   ├── config/               # Configuration management
│   │   └── config.go
│   ├── middleware/           # HTTP middleware
│   │   ├── auth.go          # Authentication middleware
│   │   └── logging.go       # Logging and recovery middleware
│   └── database/             # Database layer (generated by sqlc)
│       ├── db.go            # Database interface
│       ├── models.go        # Database models
│       ├── users.sql.go     # User queries
│       └── tasks.sql.go     # Task queries
├── models/                   # API response models
│   ├── users.go
│   └── tasks.go
├── sql/                      # Database schema and queries
│   ├── queries/
│   │   ├── users.sql
│   │   └── tasks.sql
│   └── schema/
│       ├── 001_users.sql
│       ├── 002_users_apikey.sql
│       ├── 003_tasks.sql
│       └── 004_tasks_fields.sql
└── vendor/                   # Go modules dependencies
```

## 🎯 Design Patterns & Best Practices

### 1. Clean Architecture
- **Separation of Concerns**: Each layer has a single responsibility
- **Dependency Injection**: Database dependencies are injected
- **Interface Segregation**: Clean interfaces for database operations

### 2. Error Handling
- **Consistent Error Responses**: Standardized JSON error format
- **Proper HTTP Status Codes**: RESTful status code usage
- **Error Logging**: Comprehensive error logging with context

### 3. Security
- **API Key Authentication**: Secure authentication mechanism
- **Input Validation**: Comprehensive request validation
- **SQL Injection Prevention**: Parameterized queries
- **Authorization**: Users can only access their own resources

### 4. Performance
- **Connection Pooling**: Optimized database connection management
- **Middleware Pipeline**: Efficient request processing
- **Graceful Shutdown**: Proper resource cleanup

### 5. Code Organization
- **Package Structure**: Logical package organization
- **Constants**: Error messages and configuration as constants
- **Regular Expressions**: Compiled once for performance
- **Context Usage**: Request context for cancellation and timeouts

## 🔧 Configuration

The application supports configuration through environment variables:

### Required
- `DB_URL`: PostgreSQL connection string

### Optional (with defaults)
- `PORT`: Server port (default: 8080)
- `SERVER_TIMEOUT`: Graceful shutdown timeout (default: 30s)
- `READ_TIMEOUT`: Request read timeout (default: 10s)
- `WRITE_TIMEOUT`: Response write timeout (default: 15s)
- `IDLE_TIMEOUT`: Connection idle timeout (default: 60s)
- `DB_MAX_OPEN_CONNS`: Max open DB connections (default: 25)
- `DB_MAX_IDLE_CONNS`: Max idle DB connections (default: 25)
- `DB_CONN_MAX_LIFETIME`: Max connection lifetime (default: 5m)

## 🧪 Testing the API

### Using curl

1. **Create a user:**
```bash
curl -X POST http://localhost:8080/v1/user \
  -H "Content-Type: application/json" \
  -d '{"username": "testuser"}'
```

2. **Create a task:**
```bash
curl -X POST http://localhost:8080/v1/tasks \
  -H "Content-Type: application/json" \
  -H "Authorization: APIKEY your_api_key_here" \
  -d '{"title": "My first task", "description": "Learning Go API development"}'
```

3. **Get all tasks:**
```bash
curl -X GET http://localhost:8080/v1/tasks \
  -H "Authorization: APIKEY your_api_key_here"
```

## 🚀 Next Steps for Learning

This project is designed to be beginner-friendly while demonstrating production-ready patterns. Here are suggested next steps:

### Beginner Level
1. **Understand the Request Flow**: Follow a request from `main.go` through middleware to handlers
2. **Study the Database Layer**: Examine how SQLC generates type-safe database code
3. **Explore Middleware**: Understand how authentication and logging middleware work
4. **Practice API Testing**: Use the provided curl examples to test all endpoints

### Intermediate Level
1. **Add Unit Tests**: Write tests for handlers and business logic
2. **Implement Pagination**: Add offset/limit pagination to task listing
3. **Add Input Validation**: Implement more sophisticated validation rules
4. **Metrics & Monitoring**: Add Prometheus metrics and health checks

### Advanced Level
1. **Add RBAC**: Implement role-based access control
2. **Caching Layer**: Add Redis for performance optimization
3. **Rate Limiting**: Implement API rate limiting
4. **Database Migrations**: Add automatic database migration system
5. **Containerization**: Add Docker and Docker Compose setup

## 🤝 Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests if applicable
5. Submit a pull request

## 📝 License

This project is open source and available under the [MIT License](LICENSE).

## 💡 Learning Resources

- [Effective Go](https://golang.org/doc/effective_go.html)
- [Go Web Examples](https://gowebexamples.com/)
- [Chi Router Documentation](https://github.com/go-chi/chi)
- [SQLC Documentation](https://docs.sqlc.dev/)
- [PostgreSQL Documentation](https://www.postgresql.org/docs/)

---

Happy coding! 🎉 This project demonstrates clean Go practices and is perfect for learning modern web API development with Go.
